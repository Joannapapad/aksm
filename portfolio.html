<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="icon" href="assets/aksm_logo.png">
    <meta name="description" content="Explore AKSM's portfolio, showcasing our expertise in surveying, scan2bim and UAV mapping. Discover a range of completed projects, from buildings, towers, malls to cultural centers, reflecting our commitment to quality, safety, and innovation.">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portfolio</title>
    <link rel="stylesheet" href="css/portfolio_styles.css">
    <script src="nav.js" defer></script>

    <!-- Load jQuery without 'defer' to ensure it's available immediately -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    
    <style>
.responsive-container-block.opt-cont {
    display: flex; /* Use flexbox for layout */
    justify-content: space-between; /* Space between tabs and dropdown */
    align-items: center; /* Center align items vertically */
    margin-bottom: 20px; /* Space below the tab and filter section */
}

.tabs {
    display: flex; /* Align tabs in a row */
}

.tab {
    margin-right: 15px; /* Space between tabs */
    cursor: pointer; /* Change cursor on hover */
    padding: 10px; /* Add some padding */
}

.tab-active {
    font-weight: bold; /* Highlight active tab */
    color: #ff6600; /* Active color */
}

.filter-dropdown {
    display: flex;
    align-items: center; /* Center align dropdown vertically */
}

.filter-dropdown label {
    margin-right: 5px; /* Space between label and dropdown */
}

.filter-dropdown select {
    padding: 5px;
    border: 1px solid #ccc;
    border-radius: 4px;
    font-size: 14px; /* Consistent font size */
}
.menu_maker{
    display: flex;
    flex-direction: column;
}
@media(max-width:1300px){
    .menu_maker{
    display: block;
}
}
        
    </style>
</head>
<body>
    <div id="menu-container"></div>

    <div class="center_esp">
        <a href="https://www.aksm.gr/wp-content/uploads/2023/12/aksm_antagonistikotita_webEN.pdf" target="_blank">
            <img src="assets/espa.webp" class="logo_espa" alt="espa banner">
        </a>
    </div>

    <script>
        fetch('header.html')
            .then(response => response.text())
            .then(data => {
                document.getElementById('menu-container').innerHTML = data;
                // Removed dynamic loading of nav.js
            })
            .catch(error => {
                console.error('Error fetching header:', error);
            });

        window.addEventListener('load', () => {
            document.body.classList.add('loaded');
        });
    </script>

    <a href="index.html">
        <img src="assets/aksm_logo.png" class="logo_header" alt="AKSM Logo">
    </a>

    <div class="featured_projects" unique-script-id="w-w-dm-id">
        <div class="container-block bg">
            <div class="heading-container">
                <h1 class="head">Portfolio</h1>
                <div class="animated-line-container2">
                    <div class="animated-line2"></div>
                </div>
                <p>Aksm has contributed to a variety of projects</p>
            </div>

        <div class="responsive-container-block opt-cont">
            <div class="menu_maker">
                <div class="tabs">
                    <p class="text-blk tab tab-active" data-filter="all">All</p>
                    <p class="text-blk tab" data-filter="scan2bim">SCAN2BIM</p>
                    <p class="text-blk tab" data-filter="const_ind_surv">CONSTRUCTION & INDUSTRIAL SURVEYING</p>
                    <p class="text-blk tab" data-filter="deformation_monitoring">DEFORMATION MONITORING</p>
                    <p class="text-blk tab" data-filter="uav_mapping">UAV MAPPING</p>
                </div>
                
                <!-- Dropdown Filter on the side -->
                <div class="filter-dropdown">
                    <label for="project-status">Filter by:</label>
                    <select id="project-status">
                        <option value="all">All Projects</option>
                        <option value="ongoing">Ongoing Projects</option>
                        <option value="finished">Finished Projects</option>
                    </select>
                </div>
            </div>
        </div>

            <div class="responsive-container-block content" id="portfolio-container">
                <!-- Project content will be dynamically inserted here -->
            </div>
        </div>
    </div>

    <div id="footer__cont"></div>

    <script>
        // Fetch and insert the footer
        fetch('footer.html')
            .then(response => response.text())
            .then(data => {
                document.getElementById('footer__cont').innerHTML = data;
            })
            .catch(error => {
                console.error('Error fetching footer:', error);
            });

            function generateProjectHTML(project) {
                let projectClass = project.typeofproject2;
            
                // Determine the subcategory class based on the project's status
                if (project.typeofproject2 === 'const_ind_surv') {
                    if (project.status === 'ongoing') {
                        projectClass += ' const_ind_surv_ongoing';
                    } else if (project.status === 'finished') {
                        projectClass += ' const_ind_surv_finished';
                    }
                }
            
                return `
                    <a href="project_details.html?id=${project.id}" class="link-wrapper ${projectClass}">
                        <div class="responsive-container-block img ${projectClass}" id="${project.id}">
                            <img class="im image-block" src="${project.image_front}" alt="${project.title}">
                            <div class="responsive-container-block overlay overlay-visible"></div>
                            <div class="responsive-container-block desc">
                                <p class="text-blk title">${project.title}, ${project.location}</p>
                                <p class="text-blk info">
                                    ${project.status === 'ongoing' ? 'Ongoing Project' : 'Completed in: ' + project.completionyear}
                                    <br>${project.typeofproject.toUpperCase()}
                                </p>
                            </div>
                        </div>
                    </a>
                `;
            }


        // Fetch and display projects
        fetch('project.json')
            .then(response => response.json())
            .then(projects => {
                const container = document.getElementById('portfolio-container');

                // Insert projects into the DOM
                projects.forEach(project => {
                    container.innerHTML += generateProjectHTML(project);
                });

                // Initialize hover and tab functionality
                initializeHoverAndTabFunctionality();
            })
            .catch(error => {
                console.error('Error fetching projects:', error);
            });
        
function initializeHoverAndTabFunctionality() {
    // Hide description and overlay initially
    $("[unique-script-id='w-w-dm-id'] .img .desc, [unique-script-id='w-w-dm-id'] .img .overlay").hide();

    // Use CSS for hover effects
    $("[unique-script-id='w-w-dm-id'] .img").hover(
        function() {
            $(this).find('.overlay, .desc').stop(true, true).fadeIn(200);
        },
        function() {
            $(this).find('.overlay, .desc').stop(true, true).fadeOut(200);
        }
    );

    // Handle main tab clicks
    $("[unique-script-id='w-w-dm-id'] .tab").click(function() {
        const value = $(this).attr('data-filter');

        // Use one hide and one show for improved performance
        const $allLinks = $("[unique-script-id='w-w-dm-id'] .link-wrapper");

        // Hide all projects initially
        $allLinks.hide(500);

        // Show projects based on the selected tab
        if (value === 'all') {
            $allLinks.show(500);
        } else {
            $allLinks.filter(`.${value}`).show(500);
        }

        // Set active class
        $(".tab").removeClass('tab-active');
        $(this).addClass('tab-active');
    });

    // Filter based on dropdown selection
    $('#project-status').change(function() {
        const selectedValue = $(this).val();

        const $allLinks = $("[unique-script-id='w-w-dm-id'] .link-wrapper");
        $allLinks.hide(500);

        // Show projects based on dropdown selection
        if (selectedValue === 'ongoing') {
            $allLinks.filter('.const_ind_surv_ongoing').show(500);
        } else if (selectedValue === 'finished') {
            $allLinks.filter('.const_ind_surv_finished').show(500);
        } else {
            $allLinks.show(500); // Show all projects if "All Projects" is selected
        }
    });

    // Function to get query parameter value by name
    function getQueryParam(param) {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get(param);
    }

    // Get the filter query parameter
    const filter = getQueryParam('filter');

    // If there is a filter parameter, set the corresponding tab as active and show the projects
    if (filter) {
        const targetTab = $(`.tab[data-filter="${filter}"]`);
        if (targetTab.length) {
            targetTab.click(); // Trigger tab click to show appropriate projects
        }
    } else {
        // Default behavior if no filter parameter
        $('.tab[data-filter="all"]').addClass('tab-active');
    }
}

// Call the function to initialize functionality
$(document).ready(function() {
    initializeHoverAndTabFunctionality();
});


    </script>
</body>
</html>
