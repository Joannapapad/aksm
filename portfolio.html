<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="icon" href="assets/aksm_logo.png">
    <meta name="description" content="Explore AKSM's portfolio, showcasing our expertise in surveying, scan2bim and UAV mapping. Discover a range of completed projects, from buildings, towers, malls to cultural centers, reflecting our commitment to quality, safety, and innovation.">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portfolio</title>
    <link rel="stylesheet" href="css/portfolio_styles.css">
    <script src="nav.js" defer></script>

    <!-- Load jQuery without 'defer' to ensure it's available immediately -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    
    <style>
        .filter-dropdown {
            display: inline-block;
            margin-left: 10px; /* Space between the tab and dropdown */
        }
        
        .filter-dropdown select {
            padding: 5px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

    </style>
</head>
<body>
    <div id="menu-container"></div>

    <div class="center_esp">
        <a href="https://www.aksm.gr/wp-content/uploads/2023/12/aksm_antagonistikotita_webEN.pdf" target="_blank">
            <img src="assets/espa.webp" class="logo_espa" alt="espa banner">
        </a>
    </div>

    <script>
        fetch('header.html')
            .then(response => response.text())
            .then(data => {
                document.getElementById('menu-container').innerHTML = data;
                // Removed dynamic loading of nav.js
            })
            .catch(error => {
                console.error('Error fetching header:', error);
            });

        window.addEventListener('load', () => {
            document.body.classList.add('loaded');
        });
    </script>

    <a href="index.html">
        <img src="assets/aksm_logo.png" class="logo_header" alt="AKSM Logo">
    </a>

    <div class="featured_projects" unique-script-id="w-w-dm-id">
        <div class="container-block bg">
            <div class="heading-container">
                <h1 class="head">Portfolio</h1>
                <div class="animated-line-container2">
                    <div class="animated-line2"></div>
                </div>
                <p>Aksm has contributed to a variety of projects</p>
            </div>

            <div class="responsive-container-block opt-cont">
                <p class="text-blk tab tab-active" data-filter="all">All</p>
                <p class="text-blk tab" data-filter="scan2bim">SCAN2BIM</p>
                
                <div class="tab-group">
                    <p class="text-blk tab main-tab" data-filter="const_ind_surv">CONSTRUCTION & INDUSTRIAL SURVEYING</p>
                    <div class="subtabs">
                        <p class="text-blk subtab" data-filter="const_ind_surv_ongoing">Ongoing Projects</p>
                        <p class="text-blk subtab" data-filter="const_ind_surv_finished">Finished Projects</p>
                    </div>
                    <!-- Dropdown Filter -->
                    <div class="filter-dropdown">
                        <label for="project-status">Filter by:</label>
                        <select id="project-status">
                            <option value="all">All Projects</option>
                            <option value="ongoing">Ongoing Projects</option>
                            <option value="finished">Finished Projects</option>
                        </select>
                    </div>
                </div>


            <div class="responsive-container-block content" id="portfolio-container">
                <!-- Project content will be dynamically inserted here -->
            </div>
        </div>
    </div>

    <div id="footer__cont"></div>

    <script>
        // Fetch and insert the footer
        fetch('footer.html')
            .then(response => response.text())
            .then(data => {
                document.getElementById('footer__cont').innerHTML = data;
            })
            .catch(error => {
                console.error('Error fetching footer:', error);
            });

            function generateProjectHTML(project) {
                let projectClass = project.typeofproject2;
            
                // Determine the subcategory class based on the project's status
                if (project.typeofproject2 === 'const_ind_surv') {
                    if (project.status === 'ongoing') {
                        projectClass += ' const_ind_surv_ongoing';
                    } else if (project.status === 'finished') {
                        projectClass += ' const_ind_surv_finished';
                    }
                }
            
                return `
                    <a href="project_details.html?id=${project.id}" class="link-wrapper ${projectClass}">
                        <div class="responsive-container-block img ${projectClass}" id="${project.id}">
                            <img class="im image-block" src="${project.image_front}" alt="${project.title}">
                            <div class="responsive-container-block overlay overlay-visible"></div>
                            <div class="responsive-container-block desc">
                                <p class="text-blk title">${project.title}, ${project.location}</p>
                                <p class="text-blk info">
                                    ${project.status === 'ongoing' ? 'Ongoing Project' : 'Completed in: ' + project.completionyear}
                                    <br>${project.typeofproject.toUpperCase()}
                                </p>
                            </div>
                        </div>
                    </a>
                `;
            }


        // Fetch and display projects
        fetch('project.json')
            .then(response => response.json())
            .then(projects => {
                const container = document.getElementById('portfolio-container');

                // Insert projects into the DOM
                projects.forEach(project => {
                    container.innerHTML += generateProjectHTML(project);
                });

                // Initialize hover and tab functionality
                initializeHoverAndTabFunctionality();
            })
            .catch(error => {
                console.error('Error fetching projects:', error);
            });
        
function initializeHoverAndTabFunctionality() {
    // Hide description and overlay initially
    $("[unique-script-id='w-w-dm-id'] .img .desc").hide();
    $("[unique-script-id='w-w-dm-id'] .img .overlay").hide();

    // Hover effects
    $("[unique-script-id='w-w-dm-id'] .img").mouseenter(function() {
        $(this).find('.overlay').fadeIn();
        $(this).find('.desc').fadeIn();
    }).mouseleave(function() {
        $(this).find('.overlay').fadeOut();
        $(this).find('.desc').fadeOut();
    });

    // Handle main tabs without subtabs
    $("[unique-script-id='w-w-dm-id'] .tab:not(.main-tab)").click(function() {
        const value = $(this).attr('data-filter');

        if (value === 'all') {
            $("[unique-script-id='w-w-dm-id'] .link-wrapper").show(500);
        } else {
            $("[unique-script-id='w-w-dm-id'] .link-wrapper").hide(500);
            $("[unique-script-id='w-w-dm-id'] .link-wrapper." + value).show(500);
        }

        // Set active class
        $(".tab, .subtab").removeClass('tab-active');
        $(this).addClass('tab-active');
    });

    // Handle subtab clicks
    $("[unique-script-id='w-w-dm-id'] .subtab").click(function(event) {
        const filterValue = $(this).attr('data-filter');

        // Hide all projects
        $("[unique-script-id='w-w-dm-id'] .link-wrapper").hide(500);

        // Show only the projects matching the filter
        $("[unique-script-id='w-w-dm-id'] .link-wrapper." + filterValue).show(500);

        // Set active class
        $(".tab, .subtab").removeClass('tab-active');
        $(this).addClass('tab-active');

        // Prevent event from bubbling up to the document
        event.stopPropagation();

        // Hide subtabs after selecting
        $('.subtabs').hide();
    });

    // Handle clicks outside the submenu
    $(document).click(function(event) {
        const target = $(event.target);

        // Check if the click is outside the tab group
        if (!target.closest('.tab-group').length) {
            // Hide the submenu
            $('.subtabs').hide();
        }
    });

    // Filter based on dropdown selection
    $('#project-status').change(function() {
        const selectedValue = $(this).val();

        // Hide all projects initially
        $("[unique-script-id='w-w-dm-id'] .link-wrapper").hide(500);

        if (selectedValue === 'ongoing') {
            // Show only ongoing projects
            $("[unique-script-id='w-w-dm-id'] .link-wrapper.const_ind_surv_ongoing").show(500);
        } else if (selectedValue === 'finished') {
            // Show only finished projects
            $("[unique-script-id='w-w-dm-id'] .link-wrapper.const_ind_surv_finished").show(500);
        } else {
            // Show all projects if "All Projects" is selected
            $("[unique-script-id='w-w-dm-id'] .link-wrapper").show(500);
        }
    });

    // Function to get query parameter value by name
    function getQueryParam(param) {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get(param);
    }

    // Get the filter query parameter
    const filter = getQueryParam('filter');

    // If there is a filter parameter, set the corresponding tab as active and show the projects
    if (filter) {
        const targetTab = $(`.tab[data-filter="${filter}"]`);
        const targetSubtab = $(`.subtab[data-filter="${filter}"]`);
        if (targetSubtab.length) {
            targetSubtab.click(); // Trigger subtab click to show appropriate projects
        } else if (targetTab.length) {
            targetTab.click(); // Trigger main tab click to show appropriate projects
        }
    } else {
        // Default behavior if no filter parameter
        $('.tab[data-filter="all"]').addClass('tab-active');
    }
}

    </script>
</body>
</html>
