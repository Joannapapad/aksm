<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="icon" href="assets/aksm_logo.png">
    <meta name="description" content="Explore AKSM's portfolio, showcasing our expertise in surveying, scan2bim and UAV mapping. Discover a range of completed projects, from buildings, towers, malls to cultural centers, reflecting our commitment to quality, safety, and innovation.">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portfolio</title>
    <link rel="stylesheet" href="css/portfolio_styles.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js" ></script>
    <script src="nav.js" defer></script>

    <style>
/* Styles for the tabs */


/* Active state styles for main tabs */
.tab-active {
  color: #817C76; /* Example active color */
  border-bottom: 2px solid #817C76; /* Active indicator for main tabs */
  width: auto;
}

/* Styles for the subtabs */
.featured_projects .dropdown-content p {
  color: #999999; /* Default color for subtabs */
  text-align: center;
}

/* Active state styles for subtabs */
.subtab.tab-active {
  color: #817C76; /* Example active color for active subtab */
  border-bottom: none; /* No border for active subtabs */
}

/* Remove border for all subtabs */
.dropdown-content p {
  border-bottom: none; /* Ensure no border for subtabs */
  font-size: 1.1em;
  padding: 15px;
  cursor: pointer;
}

/* Dropdown structure */
.dropdown {
  position: relative; /* Important for positioning the absolute dropdown */
}

/* Dropdown content */
.dropdown-content {
  display: none; /* Keep it hidden by default */
  position: absolute; /* Position absolutely */
  left: 50%; /* Center horizontally */
  transform: translateX(-50%); /* Center it properly */
  top: 100%; /* Position it directly below the tab */
  background-color: #f3f3f3;
  max-width: 350px; /* Set a max-width */
  z-index: 1; /* Ensure it appears above other content */
  padding: 0; /* Remove padding if necessary */
}

/* Show dropdown on hover */
.dropdown:hover .dropdown-content {
  display: block; /* Show dropdown when hovering */
}

/* Media query for small screens */
@media (max-width: 900px) {


  .dropdown-content {
    display: block; /* Show dropdown by default for small screens */
    position: relative; /* Change to relative to take up space in the menu */
    background-color: #f3f3f3; /* Ensure consistent background color */
    min-width: 200px; /* Set a minimum width */
    margin-top: 0; /* No top margin, as it will take up space in the flow */
  }

  /* Styles for the subtabs */
  .featured_projects .dropdown-content p {
    padding: 10px; /* Adjust padding if necessary */
  }

  /* Optionally, you might want to add some spacing between tabs */
  .tab {
    margin-bottom: 10px; /* Space between tabs */
  }
}

    </style>
</head>
<body>
    <div id="menu-container"></div>

    <div class="center_esp">
        <a href="https://www.aksm.gr/wp-content/uploads/2023/12/aksm_antagonistikotita_webEN.pdf" target="_blank">
            <img src="assets/espa.webp" class="logo_espa" alt="espa banner">
        </a>
    </div>

    <script>
        fetch('header.html')
            .then(response => response.text())
            .then(data => {
                document.getElementById('menu-container').innerHTML = data;

                const script = document.createElement('script');
                script.src = 'nav.js';
                document.body.appendChild(script);
            });

        window.addEventListener('load', () => {
            document.body.classList.add('loaded');
        });
    </script>

    <a href="index.html">
        <img src="assets/aksm_logo.png" class="logo_header" alt="AKSM Logo">
    </a>

    <div class="featured_projects" unique-script-id="w-w-dm-id">
        <div class="container-block bg">
            <div class="heading-container">
                <h1 class="head">Portfolio</h1>
                <div class="animated-line-container2">
                    <div class="animated-line2"></div>
                </div>
                <p>Aksm has contributed to a variety of projects</p>
            </div>

            <div class="responsive-container-block opt-cont">
                <div class="menu_maker">
                    <div class="tabs">
                        <p class="text-blk tab tab-active" data-filter="all">All</p>
                        <p class="text-blk tab" data-filter="scan2bim">SCAN2BIM</p>

                        <!-- Dropdown Menu -->
                        <div class="dropdown">
                            <p class="text-blk tab" data-filter="const_ind_surv">CONSTRUCTION & INDUSTRIAL SURVEYING</p>
                            <div class="dropdown-content">
                                <p class="subtab" data-filter="ongoing">Ongoing Projects</p>
                                <p class="subtab" data-filter="finished">Completed Projects</p>
                            </div>
                        </div>
                        

                        <p class="text-blk tab" data-filter="deformation_monitoring">DEFORMATION MONITORING</p>
                        <p class="text-blk tab" data-filter="uav_mapping">UAV MAPPING</p>
                    </div>
                </div>
            </div>

            <div class="responsive-container-block content" id="portfolio-container">
                <!-- Project content will be dynamically inserted here -->
            </div>
        </div>
    </div>

    <div id="footer__cont"></div>
    <script>

document.addEventListener('DOMContentLoaded', function () {
    const dropdowns = document.querySelectorAll('.dropdown');

    // Function to save the active main tab to localStorage
    function setActiveTab(filterValue) {
        localStorage.setItem('activeTab', filterValue);
    }

    // Function to save the active subtab to localStorage
    function setActiveSubTab(subtabValue) {
        localStorage.setItem('activeSubTab', subtabValue);
    }

    // Function to retrieve the active main tab from localStorage
    function getActiveTab() {
        return localStorage.getItem('activeTab') || 'all'; // Default to 'all' if nothing is stored
    }

    // Function to retrieve the active subtab from localStorage
    function getActiveSubTab() {
        return localStorage.getItem('activeSubTab'); // Returns null if no subtab is stored
    }

    // Function to close all dropdowns
    function closeDropdowns() {
        const $portfolioContainer = $("[unique-script-id='w-w-dm-id']");
        $portfolioContainer.find('.dropdown-content').hide(); // Hide all dropdowns
    }

    // Function to trigger the tab click and display content
    function triggerTab(tabFilter, subtabFilter = null) {
        const $portfolioContainer = $("[unique-script-id='w-w-dm-id']");
        const $allLinks = $portfolioContainer.find(".link-wrapper");

        // Simulate the main tab click based on the stored tab
        const $mainTab = $portfolioContainer.find(`.tab[data-filter="${tabFilter}"]`);
        $mainTab.click();

        // If there is an active subtab, simulate its click too
        if (subtabFilter) {
            const $subTab = $portfolioContainer.find(`.subtab[data-filter="${subtabFilter}"]`);
            $subTab.click();
        }
    }

    // Initialize tabs and subtabs with active class and functionality
    function initializeTabs(projects) {
        const $portfolioContainer = $("[unique-script-id='w-w-dm-id']");
        const $allLinks = $portfolioContainer.find(".link-wrapper");

        // Hide description and overlay initially
        $portfolioContainer.find(".img .desc").hide();
        $portfolioContainer.find(".img .overlay").hide();

        // Hover effects for project images
        $portfolioContainer.find(".img").hover(
            function () {
                $(this).find('.overlay, .desc').fadeIn();
            },
            function () {
                $(this).find('.overlay, .desc').fadeOut();
            }
        );

        // Main tab click handling
        $portfolioContainer.find(".tab").click(function () {
            const value = $(this).attr('data-filter');

            // Remove active state from all tabs and subtabs
            $portfolioContainer.find(".tab").removeClass('tab-active');
            $portfolioContainer.find(".subtab").removeClass('tab-active'); // Reset subtab active state

            // Set active state for clicked tab
            $(this).addClass('tab-active');

            // Save the active main tab in localStorage
            setActiveTab(value);

            // Hide all projects initially
            $allLinks.hide();

            // Show projects based on selected tab
            if (value === 'all') {
                $allLinks.show(500);
            } else {
                // Show projects matching the clicked tab's filter
                $allLinks.filter(`.${value}`).show(500);
            }

            // Hide dropdown content if any subtab or another tab is clicked
            $portfolioContainer.find('.dropdown-content').hide();
        });

        // Subtab click handling for dropdown
        $portfolioContainer.find(".subtab").click(function (event) {
            event.stopPropagation(); // Prevent the event from bubbling up to the parent elements
            const selectedValue = $(this).attr('data-filter');
            const status = selectedValue === 'ongoing' ? 'ongoing' : 'finished';

            // Set the active state for the clicked subtab
            $portfolioContainer.find(".subtab").removeClass('tab-active');
            $(this).addClass('tab-active');

            // Ensure parent dropdown tab is still highlighted
            $portfolioContainer.find(".tab").removeClass('tab-active'); // Clear all main tabs
            $portfolioContainer.find(".tab[data-filter='const_ind_surv']").addClass('tab-active'); // Keep dropdown parent active

            // Save the subtab in localStorage
            setActiveSubTab(selectedValue);

            $allLinks.hide(); // Hide all links initially

            // Show projects based on status (ongoing/finished) and type (const_ind_surv)
            $allLinks.each(function () {
                const projectId = $(this).attr('id');
                const projectData = projects.find(item => item.id === projectId);
                // Ensure that the project is of type const_ind_surv
                if (projectData && projectData.status === status && projectData.typeofproject2 === 'const_ind_surv') {
                    $(this).show(500); // Show the matching projects
                }
            });

            // Hide the dropdown content after selection
            $portfolioContainer.find('.dropdown-content').hide();
        });

        // Open the dropdown when hovering over the parent tab
        $portfolioContainer.find('.dropdown').hover(
            function () {
                $(this).find('.dropdown-content').show();
            },
            function () {
                $(this).find('.dropdown-content').hide();
            }
        );

        // Click event for touch devices to toggle dropdown visibility
        $portfolioContainer.find('.dropdown > .tab').click(function (event) {
            event.stopPropagation(); // Prevent the event from bubbling up to the parent elements
            $(this).siblings('.dropdown-content').toggle(); // Toggle the dropdown content visibility
        });

        // Close dropdown if clicked outside
        $(document).click(function () {
            closeDropdowns(); // Use the closeDropdowns function to hide dropdowns
        });
    }

    // Fetch the project data and initialize everything
    fetch('project.json')
        .then(response => response.json())
        .then(projects => {
            const container = $('#portfolio-container');

            // Generate project HTML and append it to the container
            projects.forEach(project => {
                const projectHTML = `
                    <a href="project_details.html?id=${project.id}" class="link-wrapper ${project.typeofproject2}" id="${project.id}">
                        <div class="responsive-container-block img ${project.typeofproject2}">
                            <img class="im image-block" src="${project.image_front}">
                            <div class="responsive-container-block overlay overlay-visible"></div>
                            <div class="responsive-container-block desc">
                                <p class="text-blk title">${project.title}, ${project.location}</p>
                                <p class="text-blk info">Completed Project ${project.completionyear} <br>${project.typeofproject.toUpperCase()}</p>
                            </div>
                        </div>
                    </a>`;
                container.append(projectHTML);
            });

            // Initialize hover and tab functionality after projects are loaded
            initializeTabs(projects);

            // Trigger the last active tab and subtab on page load
            const activeTab = getActiveTab();
            const activeSubTab = getActiveSubTab();
            triggerTab(activeTab, activeSubTab);

            // Close dropdowns by default
            closeDropdowns(); // Ensure dropdowns are closed when page loads
        });
});
fetch('footer.html')
    .then(response => response.text())
    .then(data => {
        document.getElementById('footer__cont').innerHTML = data;
    });


</script>
        
</body>
</html>
